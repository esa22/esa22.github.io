<!--Common Header-->
<!DOCTYPE html>
<html lang="en"><head>
<title>Salaries of Brazilian Mayors in SP Metro Region</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link href='http://fonts.googleapis.com/css?family=Comfortaa|McLaren' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="css/headerStyle.css" type="text/css">
<link rel="stylesheet" href="css/projectStyle.css" type="text/css">
</head>

<body>
<div id="headerBox">
<a href="../../"><h1>Evan Andrews <br>Experiments in Information Design</a>
  <a href="https://twitter.com/EvanSAndrews" target="_blank"><img id="twitter" src="img/icons/Twitter_logo_white.png" height="32" width="32"/></a>
  <a href="https://github.com/esa22" target="_blank"><img id="github" src="img/icons/GitHub-Mark-Light-32px.png"/></a>
  </h1>
</div>
<!--End of Common Header-->


<div id="projectCanvas" class="project">
  <!--MicroRegion Selection-->
  <select id="microSelect" onchange="selectMicroRegion()">
    <option value="muniBubble">All Micro Regions
    <option value="Franco_da_Rocha">Franco da Rocha
    <option value="Guarulhos">Guarulhos
    <option value="Itapecerica_da_Serra">Itapecerica da Serra
    <option value="Mogi_das_Cruzes">Mogi das Cruzes
    <option value="Osasco">Osasco
    <option value="Santos">Santos
    <option value="Sao_Paulo">Sao Paulo
  </select>
  <!--Language Selection-->
  <select id="langSelect" onchange="changeLanguage()">
    <option value="EN">English
    <option value="PT">Portugues
  </select>
  <!--Chart appended here-->
</div>
<p></p>
</body>

<script src="lib/d3.js"></script>
<script src="lib/chartObj.js"></script>
<!--<script src="lib/eUtil.js"></script>-->
<script>
//Select the language
var lang = "EN"; //default
var ll = getUrlParam("l");
if(ll === "PT" | ll === "pt"){
  //change actual language variable
  lang = "PT";
  //change language selection box
  document.getElementById("langSelect").selectedIndex = 1;
  //change language in other selection box
  changeMicroLang();
  //console.log("porewef");
}

//First establish and render a viewing area
var width = 960;
var height = 600;

//bubble coloring scheme
var bubbleColors = {main: "olivedrab", flash: "cyan", highlight: "yellow", background: "lightgray"};
var bubbleStrokeColor = {main: "gold", flash: "olivedrab", highlight: "olivedrab", background: "lightgray"};
var hatPathColor = {main: "cadetblue", background: "lightgray"};
var bubbleFillOpacity = {main: 0.8, flash: 0.9, background: 0.3, highlight: 0.9};
var bubbleStrokeOpacity = {main: 0.8, flash: 0.9, background: 0.3, highlight: 0.9};

//determine svg origin location on webpage
var origin = document.getElementById("projectCanvas").getBoundingClientRect();

//initialize chart object
//range stays at 0 to 30. Can zoom in or out on x. Good values are 180, 270, and 3300
var chart = chartObj()
        .y(d3.scale.linear().domain([0, 30]))
        .x(d3.scale.linear().domain([0, 270]))
        .leftPos(origin.left)
        .topPos(origin.top);

//Load Data and Execute Script
d3.tsv("data/salaryData.txt")
  .row(function(d) {
  return {
    muniId: d.muniId, 
    muniName: d.muniName, 
    metroRegion: d.metroRegion, 
    microName: d.microName, 
    partyOfMayor2012: d.partyOfMayor2012, 
    pop1k2012: +d.pop1k2012,    //convert all vars below to number
    budget1M2012: +d.budget1M2012, 
    salaryMayor1k2014: +d.salaryMayor1k2014, 
    fitBudgetPop: +d.fitBudgetPop, 
    gapBudgetPop: +d.gapBudgetPop, 
    fitSalaryPop: +d.fitSalaryPop, 
    gapSalaryPop: +d.gapSalaryPop, 
    fitSalaryBudget: +d.fitSalaryBudget, 
    gapSalaryBudget: +d.gapSalaryBudget, 
    flagSalaryMissing: +d.flagSalaryMissing, 
    flagBudgetMissing: +d.flagBudgetMissing
  }; 
})
.get(function(error, data) {  
  //load variable names
  d3.tsv("data/varLabels.txt", function(error, varInfo) {
    console.log(varInfo);
    //Use "data" as dataset variable and "varInfo" for variable labels.
    //load data
    chart.observations(data)
         .variableInfo(varInfo);
    //render the chart
    chart.render();
  });
  //console.log(data[0]);   //see first row of dataset
  //console.log(data);   //see all of dataset
  //d3.select("p").text(data[0].muniName);
});

//reset the language
function changeLanguage(){
  lang = document.getElementById("langSelect").value;
  changeMicroLang();
  chart.render();
}

function changeMicroLang(){
  //Language in Selection Box
  var txt;
  if(lang === "EN"){
    txt = "All MicroRegions";
  }
  if(lang === "PT"){
    txt = "Todos os MicroRegioes";
  }
  document.getElementById("microSelect").children[0].innerHTML = txt;
}

var microRegion = "muniBubble";  //global var default
function selectMicroRegion(){
  microRegion = document.getElementById("microSelect").value;
  if(microRegion == "muniBubble"){
    //default settings
    d3.selectAll("." + microRegion)
      .transition().duration(400).ease("quad")
      .style("fill", bubbleColors.main)
      .style("opacity", bubbleFillOpacity.main)
      .style("stroke", bubbleStrokeColor.main)
      .style("stroke-opacity", bubbleStrokeOpacity.main);
    d3.selectAll(".dataMissing")
      .transition().duration(400).ease("quad")
      .style("fill", bubbleColors.background)
      .style("opacity", bubbleFillOpacity.background)
      .style("stroke", bubbleStrokeColor.background)
      .style("stroke-opacity", bubbleStrokeOpacity.background);
    d3.select("#fittedLineSalBudget")
      .transition().duration(400).ease("quad")
      .style("opacity", "0.8")
      .style("stroke", hatPathColor.main);
  } else {
    //selection highligting
    d3.selectAll(".muniBubble")
      .transition().duration(400).ease("quad")
      .style("fill", bubbleColors.background)
      .style("opacity", bubbleFillOpacity.background)
      .style("stroke", bubbleStrokeColor.background)
      .style("stroke-opacity", bubbleStrokeOpacity.background);
    d3.selectAll("." + microRegion)
      .transition().duration(400).ease("quad")
      .style("fill", bubbleColors.highlight)
      .style("opacity", bubbleFillOpacity.highlight)
      .style("stroke", bubbleStrokeColor.highlight)
      .style("stroke-opacity", bubbleStrokeOpacity.highlight);
    d3.select("#fittedLineSalBudget")
      .transition().duration(400).ease("quad")
      .style("opacity", "0.5")
      .style("stroke", hatPathColor.background);
  }
}

//get url parameters
function getUrlParam(name){
   if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
      return decodeURIComponent(name[1]);
}
</script>

<!--TODO
-(1) Address encoding for title 
-(2) test across browsers (firefox not showing bubbles for some reason)
-->
